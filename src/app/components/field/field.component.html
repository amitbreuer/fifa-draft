<p-card header="Team Formation" class="field-card">
  <div class="formation-selector">
    <label for="formation">Formation:</label>
    <p-select
      id="formation"
      [options]="formations"
      [(ngModel)]="selectedFormation"
      (onChange)="onFormationChange()"
      optionLabel="label"
      optionValue="value"
      placeholder="Select Formation"
      [style]="{'width': '250px'}"
    ></p-select>
  </div>

  <div class="field-container">
    <div class="field-pitch">
      <!-- Field markings -->
      <div class="half-line"></div>
      <div class="center-circle"></div>
      <div class="center-spot"></div>

      <!-- Top goal (left side when horizontal) -->
      <div class="penalty-area top"></div>
      <div class="goal-area top"></div>
      <div class="penalty-mark top"></div>

      <!-- Bottom goal (right side when horizontal) -->
      <div class="penalty-area bottom"></div>
      <div class="goal-area bottom"></div>
      <div class="penalty-mark bottom"></div>

      <!-- Corner arcs -->
      <div class="corner-arc top-left"></div>
      <div class="corner-arc top-right"></div>
      <div class="corner-arc bottom-left"></div>
      <div class="corner-arc bottom-right"></div>

      @for (position of fieldPositions; track position.id) {
      <div
        class="field-position"
        [style.left.%]="position.x"
        [style.top.%]="position.y"
        (click)="onPositionClick(position.id)"
        [class.has-player]="position.player"
        [class.can-place]="canPlacePlayer()"
      >
        @let playerName = position?.player?.commonName || `${position?.player?.firstName} ${position?.player?.lastName}`;
        <div class="position-slot">
          @if (position.player) {
          <div
            class="player-item"
            draggable="true"
            (dragstart)="onDragStart($event, position.player, false)"
            (dragend)="onDragEnd($event)"
            (drop)="onDrop($event, position.id)"
            (dragover)="onDragOver($event)"
            (dragenter)="onDragEnter($event)"
            (dragleave)="onDragLeave($event)"
          >
            <div class="player-shirt">
              <img
                src="assets/images/shirt.svg"
                alt="Player shirt"
                class="shirt-image"
                (error)="onShirtImageError($event)"
              />
              <span class="player-number">{{ getPlayerNumber(position.player) }}</span>
            </div>
            <div class="player-name">{{ playerName }}</div>
            <div class="player-rating">{{ position.player.overallRating }}</div>
          </div>
          } @else {
          <div
            class="empty-slot"
            (drop)="onDrop($event, position.id)"
            (dragover)="onDragOver($event)"
            (dragenter)="onDragEnter($event)"
            (dragleave)="onDragLeave($event)"
          >
            <i class="pi pi-plus"></i>
            <span class="position-label">{{ getPositionLabel(position.id) }}</span>
          </div>
          }
        </div>
      </div>
      }
    </div>
  </div>
</p-card>

<p-card class="bench-card">
  <ng-template pTemplate="header">
    <div class="bench-header">
      <span>Bench</span>
      <p-tag [value]="benchPlayers.length + '/7'" [severity]="isBenchFull() ? 'danger' : 'info'"></p-tag>
    </div>
  </ng-template>

  <div
    class="bench-container"
    (click)="onBenchClick()"
    (drop)="onDropToBench($event)"
    (dragover)="onDragOver($event)"
    (dragenter)="onDragEnter($event)"
    (dragleave)="onDragLeave($event)"
    [class.drag-over]="isDragOverBench"
    [class.can-place]="canPlacePlayer() && !isBenchFull()"
    [class.bench-full]="isBenchFull()"
  >
    <div class="bench-slots">
      @for (player of benchPlayers; track trackByPlayerId($index, player)) {
      <div
        class="bench-player"
        draggable="true"
        (dragstart)="onDragStart($event, player, true)"
        (dragend)="onDragEnd($event)"
        (click)="$event.stopPropagation()"
      >
        @let playerName = player.commonName || `${player.firstName} ${player.lastName}`;
        <div class="player-item">
          <div class="player-shirt">
            <img
              src="assets/images/shirt.svg"
              alt="Player shirt"
              class="shirt-image"
              (error)="onShirtImageError($event)"
            />
            <span class="player-number">{{ getPlayerNumber(player) }}</span>
          </div>
          <div class="player-name">{{ playerName }}</div>
          <div class="player-rating">{{ player.overallRating }}</div>
        </div>
      </div>
      }

      @if (benchPlayers.length === 0) {
      <div class="bench-empty-state">
        <i class="pi pi-users"></i>
        <span>Click here to add players to bench</span>
      </div>
      }
    </div>
  </div>
</p-card>

